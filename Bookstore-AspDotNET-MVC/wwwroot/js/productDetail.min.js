var form=$("#__AjaxAntiForgeryForm"),token=$('input[name="__RequestVerificationToken"]',form).val();$("#btn-add-to-cart").click(function(){var t=$("#idBook").val(),n=$("#quantity").val();if(n===""){alert("Số lượng không được để trống !! ");return}if(n<$("#quantity").attr("min")||n>$("#quantity").attr("max")){alert(`Số lượng không hợp lệ !! 
Đặt tối thiểu 1, tối đa ${$("#quantity").attr("max")}`);return}$.ajax({type:"POST",url:`/CartApi/AddOrUpdate?bookId=${t}&quantity=${n}`,data:{__RequestVerificationToken:token},success:function(n){$("#quantity").val("");alert(n)},error:n=>{console.log(n)}})});$(".quantity-book").change(function(){var t=$(this).closest(".cart-item"),i=$(this).closest(".cart-item").find(".book").attr("data-idBook"),n=$(this).val();if(n===""){alert("Số lượng không được để trống !! ");return}if(Number(n)<Number($(this).attr("min"))||Number(n)>Number($(this).attr("max"))){$(this).val(1);alert(`Số lượng không hợp lệ !! 
Đặt tối thiểu 1, tối đa ${$(this).attr("max")}`);return}$.ajax({url:"/CartApi/AddOrUpdate",type:"POST",data:{__RequestVerificationToken:token,bookId:i,quantity:n},success:function(i){var r=t.find(".book-price").attr("data-book-price"),u=r*n,f=u.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,").replace(".00",""),e=parseInt(i).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,").replace(".00","");t.find(".item-price").replaceWith('<p class="item-price">Thành tiền: <span style="font-weight: bold">'+f+"đ<\/span><\/p >");$("#total-price").replaceWith('<p style="font-size:25px" id= "total-price">Tổng tiền <span style="font-weight:bold; color:red">'+e+" đ <\/span> <\/p>")}})});$(".btn-delete-item").click(function(){var n=$(this).closest(".cart-item"),t=$(this).closest(".cart-item").find(".book").attr("data-idBook");$.ajax({type:"POST",url:"/CartApi/Delete",data:{__RequestVerificationToken:token,bookId:t},success:function(t){if(t=="false")alert("Xóa thất bại");else{t==0&&$("#btn-buy").hide();n.remove();var i=parseInt(t).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,").replace(".00","");$("#total-price").replaceWith('<p style="font-size:25px" id= "total-price">Tổng tiền <span style="font-weight:bold; color:red">'+i+" đ <\/span> <\/p>")}},error:()=>{console.log("Error")}})});$("#btn-buy").click(function(){$("#block-info-buy").css("display","block")});$("#dropdown-provinces").change(function(){var n=$(this).val();$.ajax({type:"POST",url:"/AddressAPI/getDisTrict",data:{provinceId:n},success:function(n){let t=n.map(n=>`<option value=${n.districtId}>${n.districtPrefix} ${n.districtName}</option>`);$("#dropdown-districts").html(t.join(""))},error:()=>{console.log("Error")}})});$("#dropdown-districts").change(function(){var n=$(this).val();$.ajax({type:"POST",url:"/AddressAPI/getWard",data:{districtId:n},success:function(n){let t=n.map(n=>`<option value=${n.wardId}>${n.wardPrefix} ${n.wardName}</option>`);$("#dropdown-villages").html(t.join(""))},error:()=>{console.log("Error")}})});$("#btn-verify-buys").click(function(){console.log("click");let n=!0;const t=$("#fullname").val(),i=$("#phone").val(),r=$("#address").val(),u=$("#dropdown-villages").val(),f=$("#dropdown-payment").val();if(console.log($("#phone").val()),t.length==0&&($(".check-name-field").css("display","block"),n=!1),i.length!=10&&($(".check-phone-field").css("display","block"),n=!1),n==!0){var e=confirm("Bạn sẽ mua đơn hàng này? ");e==!0&&$.ajax({type:"POST",url:"/OrderAPI/Order",data:{__RequestVerificationToken:token,fullname:t,phone:i,village:u,address:r,payment:f},success:function(){alert("Đặt hàng thành công!");location.reload()},error:()=>{console.log("Error")}})}});$("#quantity").change(function(){var n=$(this).closest("tr").find("#idBook").val(),t=$(this).val();$.ajax({url:"/check-quantity",type:"POST",data:{id:n,quantity:t},success:function(n){n!="-1"&&(alert("Vượt quá số lượng hiện có!\nSố lượng hiện tại là: "+n),location.reload())}})});$(".rating-submit").click(function(){var n=$("#__AjaxAntiForgeryForm"),t=$('input[name="__RequestVerificationToken"]',n).val(),i=parseFloat($('input[name="rating"]:checked').val()),r=$("#comment").val(),u=$("#idBook").val();$.ajax({type:"POST",url:"/ReviewApi/AddOrUpdate",data:{__RequestVerificationToken:t,idBook:u,star:i,comment:r},success:function(){location.reload()},error:()=>{console.log("Error")}})});$("#btn-review-again").click(function(){$("#inform-review-message").hide();$("#review-again-block").show()});